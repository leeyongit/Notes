Redis及缓存雪崩、缓存穿透
=====================
## 一 、简介
1.Redis的特点
Redis是一种非关系数据库(不会像Mys ql一样多个表直接存在直接关联关系),也是一种内存型数据库
Redis是单线程的,并且是直接基于内存的,所以执行效率会非常高
> 为什呢Redis是单线程的呢?(经典面试题)
官方回答 : 因为Redis是基于内存的,所以CPU不会是Redis的瓶颈,但是内存会是,而且多线程的实现比较麻烦,直接使用单线程更省事一点

因为Redis是直接操作内存的,而且是单线程的,避免了频繁的切换上下文,所以速度非常快

2.Redis的数据结构
- String : 最普通和常用的一种结构,key/value
- Hash : 类似于HashMap,底层也是哈希表
- List : 类似于LinkedList,底层是双向链表
- Set : 类似于HashSet,于HashSet的特性一样,不允许重复数据,不记录元素添加顺序
- SortSet : 会自动的进行排序的set
- Streams(流) : 18年刚刚发布的一个新的数据结构,不是太了解,相关资料比较少


## 二 、Redis持久化方案

1. RDB(默认)
* RDB是redis默认的持久化方式
* RDB是采用快照的方式来进行数据持久化的,当符合快照的条件时Redis会自动对内存中的数据进行快照,然后持久化到硬盘中
* 触发条件
    * 符合自定义配置的快照规则
    * 执行save或者bgsave命令
        * eg : save 60 10000 ：表示1分钟内至少100个键被更改则进行快照。
    * 执行flushall命令
    * 执行主从复制操作
    * 在redis.conf中设置快照规则
        * 打开redis.config文件,202行,这是RDB的默认配置,满足下面三个之一就会被触发
        > save 900 1
        > save 300 10
        > save 60 10000
        * 在247行,配置快照生成地址
        > dir ./
        * 在237行可以配置生成快照的名称,默认是dump.rdb
        > dbfilename dump.rdb
* 每次redis启动时都会去读取dump.rdb快照文件,将数据加载到内存中
原理 : Redis使用fork函数复制一份当前进程的副本(创建一个子进程)父进程继续接收处理客户端的请求,子进程负责将内存中的数据存储到硬盘中,当子进程写入完所有数据之后会用新的rdb文件替换旧的rdb文件
* 细节 : 快照的时候并不会修改原有的rdb文件,而是用新生成的替换旧的,所以rdb文件是一定存在的,rdb文件是经过压缩的二进制文件,所以占用内存会很少,并且方便读取
* 优点 : 因为是复制除了一个子进程来实现数据存储,所以父进程还是可以继续响应客户端的请求,所以客户端基基本不会受到影响,而且rdb是压缩后的二进制文件,进行数据恢复的速度会比较快,所以rbd非常适合用来做数据备份
* 缺点 : 必须要满足rdb的条件才会执行数据备份,所以有可能因为Redis的突然宕机导致部分数据丢失,所以设置快照条件时必须足够严谨

作者：高哲
链接：https://zhuanlan.zhihu.com/p/58265935

